From patchwork Tue Jul 11 06:36:29 2023
Content-Type: text/plain; charset="utf-8"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
X-Patchwork-Submitter: Peter Marko <peter.marko@siemens.com>
X-Patchwork-Id: 27170
Return-Path: <peter.marko@siemens.com>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from aws-us-west-2-korg-lkml-1.web.codeaurora.org
 (localhost.localdomain [127.0.0.1])
	by smtp.lore.kernel.org (Postfix) with ESMTP id 5240AEB64DC
	for <webhook@archiver.kernel.org>; Tue, 11 Jul 2023 06:37:47 +0000 (UTC)
Received: from mta-65-226.siemens.flowmailer.net
 (mta-65-226.siemens.flowmailer.net [185.136.65.226])
 by mx.groups.io with SMTP id smtpd.web10.1787.1689057457538882683
 for <openembedded-core@lists.openembedded.org>;
 Mon, 10 Jul 2023 23:37:38 -0700
Authentication-Results: mx.groups.io;
 dkim=pass header.i=peter.marko@siemens.com header.s=fm1 header.b=KyDERuL/;
 spf=pass (domain: rts-flowmailer.siemens.com, ip: 185.136.65.226,
 mailfrom:
 fm-256628-20230711063734f3a44b417c67521dab-txa_3j@rts-flowmailer.siemens.com)
Received: by mta-65-226.siemens.flowmailer.net with ESMTPSA id
 20230711063734f3a44b417c67521dab
        for <openembedded-core@lists.openembedded.org>;
        Tue, 11 Jul 2023 08:37:35 +0200
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; s=fm1;
 d=siemens.com; i=peter.marko@siemens.com;
 h=Date:From:Subject:To:Message-ID:MIME-Version:Content-Type:Content-Transfer-Encoding:Cc:References:In-Reply-To;
 bh=6NwHRoW8Vj+xFjkYewtwJzFyfak2K4WAGZfodfGwX48=;
 b=KyDERuL/qplG81pEeO0yqkPby6C6QeJWWTDDgAr91N6XO8RZqnmuRkstYybzr7sibP1ILw
 lkCwGu7mvgBCV+6sTfbvl6LmxE0iPNGu05aKhkdz4wrmhnbLhopcCqZDdgCdl3I/CFmqscXZ
 Quz7nput7POtm5oPTZuqsUan+HWcc=;
From: Peter Marko <peter.marko@siemens.com>
To: openembedded-core@lists.openembedded.org
Cc: Peter Marko <peter.marko@siemens.com>
Subject: [OE-core][master][mickledore][kirkstone][dunfell][PATCH 2/2]
  cve-update-nvd2-native: increase retry count
Date: Tue, 11 Jul 2023 08:36:29 +0200
Message-Id: <20230711063629.7627-2-peter.marko@siemens.com>
In-Reply-To: <20230711063629.7627-1-peter.marko@siemens.com>
References: <20230711063629.7627-1-peter.marko@siemens.com>
MIME-Version: 1.0
X-Flowmailer-Platform: Siemens
Feedback-ID: 519:519-256628:519-21489:flowmailer
List-Id: <openembedded-core.lists.openembedded.org>
X-Webhook-Received: from li982-79.members.linode.com [45.33.32.79] by
 aws-us-west-2-korg-lkml-1.web.codeaurora.org with HTTPS for
 <openembedded-core@lists.openembedded.org>; Tue, 11 Jul 2023 06:37:47 -0000
X-Groupsio-URL: 
 https://lists.openembedded.org/g/openembedded-core/message/184116

From: Peter Marko <peter.marko@siemens.com>

Current 503 errors seem to last several seconds.
In most cases there are two errors and third request succeeds.
However sometimes the outage takes more than time needed
for two retries and third one also fails.

Extend retry count from 3 to 5 to improve the probablity
that the fetcher succeeds.

Signed-off-by: Peter Marko <peter.marko@siemens.com>
---
 meta/recipes-core/meta/cve-update-nvd2-native.bb | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/meta/recipes-core/meta/cve-update-nvd2-native.bb b/meta/recipes-core/meta/cve-update-nvd2-native.bb
index a7392405e0..b3d0038c2f 100644
--- a/meta/recipes-core/meta/cve-update-nvd2-native.bb
+++ b/meta/recipes-core/meta/cve-update-nvd2-native.bb
@@ -129,7 +129,7 @@ def nvd_request_next(url, api_key, args):
 
     full_request = url + '?' + data
 
-    for attempt in range(3):
+    for attempt in range(5):
         try:
             r = urllib.request.urlopen(full_request)
 
